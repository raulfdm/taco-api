name: Website Docs

on: [push]

permissions:
  contents: read
  pull-requests: read

jobs:
  website:
    runs-on: ubuntu-latest
    steps:
      - id: extract_pr
        shell: bash
        run: |
          if [[ "${{ github.event_name }}" == "merge_group" ]]; then
            echo "number=$(echo "${{ github.ref }}" | sed -n 's|.*/pr-\([0-9]*\)-.*|\1|p')" >> $GITHUB_OUTPUT
          elif [[ "${{ github.event_name }}" == "pull_request" ]]; then
            echo "number=${{ github.event.pull_request.number }}" >> $GITHUB_OUTPUT
          fi

      - uses: jwalton/gh-find-current-pr@v1
        id: findPr
        with:
          # Can be "open", "closed", or "all".  Defaults to "open".
          state: open
      # This will echo "Your PR is 7", or be skipped if there is no current PR.
      - run: echo "Your PR is ${PR}"
        if: success() && steps.findPr.outputs.number
        env:
          PR: ${{ steps.findPr.outputs.pr }}

      - uses: actions/github-script@v7
        with:
          script: |
            async function he(){
              const result = await github.rest.repos.listPullRequestsAssociatedWithCommit({
                owner: context.repo.owner,
                repo: context.repo.repo,
                commit_sha: context.sha,
              })

              console.log(result.data[0].number)
            }
            he()

      # - name: Checkout to repository
      #   uses: actions/checkout@v4.1.1

      # - name: Setup Bun
      #   uses: oven-sh/setup-bun@v1
      #   with:
      #     bun-version: 1.0.20

      # - name: Install dependencies
      #   run: bun install --no-cache

      # - name: Build
      #   run: bun run build --filter=website

      # - name: Netlify Deploy
      #   id: netlify_deploy
      #   uses: jsmrcaga/action-netlify-deploy@v2.1.0
      #   with:
      #     install_command: "echo Skipping installing the dependencies"
      #     build_command: "echo Skipping building the web files"
      #     build_directory: ./apps/website/dist
      #     NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
      #     NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
      #     deploy_alias: ${{ env.BRANCH_NAME }}
      #     NETLIFY_DEPLOY_TO_PROD: ${{ env.BRANCH_NAME == 'main' }}
      #     monorepo_package: website

      # - name: Comment PR
      #   uses: thollander/actions-comment-pull-request@v2
      #   with:
      #     message: |
      #       [Preview](${{ steps.netlify_deploy.outputs.NETLIFY_PREVIEW_URL }})
